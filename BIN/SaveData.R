#' SaveModel
#'
#' @param model The dataframe generated by ReadModel()
#' @param name A unique name from the run.
#' @keywords MCMC
#' @export
#' @examples SaveModel()
SaveModel = function(model, name) {
    save(model, file=paste("./data/Model-", name, ".RData",sep='') )
}


#' SaveSolution
#'
#' @param solution The dataframe created by RunModel()
#' @param name A unique name from the run.
#' @keywords CCELIM
#' @export
#' @examples SaveSolution()
#' 
SaveSolution = function(solution, name) {
    save(solution, file=paste("./data/Solution-", name, ".RData",sep='') )
}


#' SaveSpread
#'
#' @param model The dataframe generated by ReadModel().
#' @param solution The dataframe created by RunModel()
#' @param name A unique name from the run.
#' @keywords CCELIM
#' @importFrom XLConnect loadWorkbook saveWorkbook createSheet writeWorksheet
#' @export
#' @examples SaveSpread()
#' 
SaveSpread = function(model, solution, name) {
    ##~~~~~~~~~~~~~~~~~~~~~ Save Spreadsheets ~~~~~~~~~~~~~~~~~~~~##
    options(java.parameters = "-Xmx4g" )
    
    flow = ReadFlows(model, solution)
    newwb = loadWorkbook(paste("./data/Flows-",name,".xlsx", sep=''), create=TRUE)
    createSheet(newwb, name="Data")
    writeWorksheet(newwb, cbind(colnames(flow),flow), sheet="Data")
    try(saveWorkbook(newwb))
    
    Ra=NULL
    Ra$X = apply(solution$X, 1, function(x) model$Aa %*% x)
    write.csv(Ra$X, paste('./data/Approx-', name, '.csv', sep=''))
    
    write.csv(solution$X, paste('./data/Raw-', name, '.csv', sep=''))
    write.csv(cbind(solution$avg,solution$sd), paste('./data/Solution-', name, '.csv', sep=''))
}